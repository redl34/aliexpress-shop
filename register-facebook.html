<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getAuth, signInWithPopup, FacebookAuthProvider } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
    import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';

    const firebaseConfig = { /* ваша конфігурація */ };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new FacebookAuthProvider();

    provider.addScope('public_profile');
    provider.addScope('email');
    provider.setCustomParameters({ 'display': 'popup' });

    async function signInWithFacebook() {
        const errorElement = document.getElementById('error');
        errorElement.textContent = 'Попытка входа...';
        try {
            const result = await signInWithPopup(auth, provider);
            const user = result.user;
            const username = user.displayName || 'User_' + user.uid.substring(0, 8);
            await setDoc(doc(db, 'users', user.uid), { username, email: user.email, phoneNumber: null }, { merge: true });
            window.location.href = 'profile.html';
        } catch (error) {
            errorElement.textContent = `Ошибка: ${error.message} (Код: ${error.code})`;
            console.error('Ошибка:', error);
        }
    }
</script>
